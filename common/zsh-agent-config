#!/bin/zsh
# ZSH Configuration for AI Agent Mode (Cursor, GitHub Copilot, etc.)
# Optimized for compatibility and minimal interference with AI tools

ZSH=$DOTFILES/zsh/oh-my-zsh

# Load local setup if exists
if [ -f $DOTFILES/local/zsh-setup ]; then
	. $DOTFILES/local/zsh-setup
fi

# Basic SSH agent for servers
if [ "$is_server" = true ]; then
    eval $(ssh-agent)
    /usr/bin/ssh-add
fi
zstyle :omz:plugins:ssh-agent agent-forwarding on

# Disable auto-updates in agent mode
DISABLE_UPDATE_PROMPT=true
DISABLE_AUTO_UPDATE=true

# Use simple theme for better agent compatibility
ZSH_THEME="robbyrussell"  # Simple, clean theme

export LS_OPTIONS='--color=auto'
COMPLETION_WAITING_DOTS="false"  # Disable for cleaner output

# Load local config if exists
if [ -f $DOTFILES/local/zsh-config ]; then
	. $DOTFILES/local/zsh-config
fi

# Minimal plugin set for agent mode - only essentials
plugins=(git gitfast ssh-agent last-working-dir)

# Add completions
fpath=($DOTFILES/zsh-completions/src $fpath)

# Load Oh My Zsh
if [ -f $ZSH/oh-my-zsh.sh ]; then
    source $ZSH/oh-my-zsh.sh
fi

export EDITOR=vim

# Set agent mode indicator
export AI_AGENT_MODE=1

# Simplified prompt for agent mode
PROMPT='%n@%m:%~$ '

# Disable fancy features that might interfere with agents
unsetopt PROMPT_SP
unsetopt PROMPT_CR
setopt PROMPT_PERCENT
setopt TRANSIENT_RPROMPT